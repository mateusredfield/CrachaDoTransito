======================== ConduApp =====================================================

Tarefas

- super servico com autenticacao

- historia de validacao do prc na requisicao

- tem q bater o cnpj com o de prc cnpj do bd

- precisa ter clientId na tabela PRC

- super servico com limitador, dados, linhas e por tempo (talvez)

- super servico com swagger a parte

- super servico abstraindo tamanho dos dados e numero de linhas, mas sabendo o formato do json

- Atribuir autenticacao do swagger no servico

- Pedir usuario teste pra fazer teste de carga

- super servico e pedir pacote treinamento (keykloak usuarios, ambiente publicacao e base de dados)

- Pedir para entrar em contato com a empresa com o json informado e pedir pra por enquanto ser
sem autencicao, mas pelo menos dar o modelo do json

- Servico pra alterar o status, de condutor, de veiculo e de PRC

- pesquisar se pode usar httpclient estatico

- motorista precisa de uma historia so pra alteracoes de status, no caso seria uma relacao punicao dele com a empresa
ou o status dele real seria derivado, no caso a consulta pelo status dele seria pelo credenciamento

- Vai precisar cadastrar status possiveis em tabela Status 

- tabela log

- Passar as tabelas para o bd certo

- Vai precisar cadastrar status possiveis em tabela Status 

- Revisar quais sao as tabelas necessarias para a primeira entrega

- bater os tipos nulls das models com os not nulls com o bd, usando builder talvez

- Vai precisar de uma tabela de usuarios

- Setransp -  vai ver empresa e status, e pode mudar esse

- estudar novamente await, a funcao de logout foi tensa

- Tratativa de erros mais consisa

- Parte de punicoes ainda nao esta clara

- Logica do numero de serie do conduapp, poderia ser uma tabela com um numero so

- Qr equipe do rafa

- Colocar mais try

- pedir vistoria no appsettings

- Frizar q nao vao conseguir dar update por chave primaria
 tem q bater o cnpj com o de prc cnpj do bd

(futuramente) - Revisar a tabela carro depois

- Ver diferenca entre IEnumerable e IList, ver sobre nullable pois o bd tem mtos null

- art 39 e 47 - reler

 - (futuramente/pos treinamento) Estudar git ignore para projeto Visual Studio, 
   mas talvez o template ja tenha

- (futuramente/pos treinamento) ler sobre addscoped 

- (futuramente/opcional) Usabilidade futura, qndo cair na pagina de atualizacao ja trazer os dados previos

- (futuramente/pos treinamento) Chaveamento da troca das versoes da api

============================================================================================

 Preciso Ler
 
  - https://learn.microsoft.com/en-us/aspnet/mvc/overview/older-versions-1/models-data/validation-with-the-data-annotation-validators-cs


============================================================================================


Anotacoes

 - Tavlez as tratativas de erro pudessem ser melhores

 - Precisa versionar o projeto exemplo pois da pra seguir dele

 - Ver onde ficam as DTOs

 - automatizado

 - Lmebrar que parece q a aplicacao fornece a interface do q ela precisa pra depois a apresentacao
 implementar essa camada

 - https://github.com/mateusredfield/CrachaDoTransito.git Keyckloak fica na infra

Talvez reler pois tem 3 tipos de injecao, construtor, propriedade e metodo
 -https://www.tutorialsteacher.com/ioc/dependency-injection#google_vignette

 - ok - Ler duvidas para reuniao, importante frizar q o pedido dos dados pode influenciar na entrega tanto da setransp qnto das empresas,
 e deixar isso homologado por email para caso ocorra atraso fica justificado

 - anotacao - DbExpress nao tem mais, agora é dblocal, nao tem limite de tamanho mas nao tem backup

 - anotacao - Reduncia pois é um projeto rapido

  - ( nao fazer ) Pegar exemplo do felipe para entender algumas modelagens. Nao fazer
 por questoes de tempo

 - Metodo pra busca parcial de placas (exmplo todas que comecem com 123, todas placas SP)

 - query tava dando pau com data annotation

 - O site mvc tem replicas da models e commands

============================================================================================

Perguntar

Bruno

 - As models do mvc precisam estar tambem no apliacao ou nao, pois e um cliente externo

- Tata

 Duvidas
 
 Tata

- Explicitar q os dados do tipo chave primaria nao serao alterados por bulk de dados
dados das empresas, mas sim por um usuario do site, no caso poderia se dar um
usuario para as empresas caso eles errem os dados

- Explicitar q as emrpesas farao bulk em ambiente de treinamento, e depois em producao

- Clonagem de placa e documentos, ex se o conduapp tiver no carro o cara consegue tirar foto
e passar em outro carro com documento de outra pessoa tb

- 1 dia util de outubro com todas as empresas muito improvavel

- faremos chacagem de multas

 - Conduapp e de motorista mas se estiver estampado no carro nao da certo pois cada carro pode ter
 diversos motoristas

 - Conduapp Sendo numero senquencial poderia ser falha de seguranca

 - cronograma com as tarefas mais trabalhosas estimadas com base no tempo que os colegas levaram para fazer coisas afins

 - Ver tamanho das requisoes com a infra

 - como vai ser a tabela log, pois ela por exemplo poderia salvar tambem os updates de dados inconsistentes das empresas

 - como vai ser a tabela punições (sanções ou penalidades, ainda não sei o nome)
   Quais vao ser as punicoes possiveis Suspensao Temporaria (com data de início termino) precisa ser colocado pela setransp
   
 - Qntos digitos o conduapp vai ser  

 - Vai ter área do motorista na apliacação

 - O motorista vai portar o conduapp apenas na foma de qr code

 - Como fica a tabela Log de ações, verificar se a modelagem do bd já tem log de ações

(parcial) Conduapp - vai ser so numeros ou vai ter letras - so numeros, sequencial, so falta qntos digitos vao ser

Duvidas pra reuniao

===========================================================================================
Regras de Negocio

 - Assumindo que os cpf viram incosistentes, o conduapp foi usado como chave no credenciamento
 - O banco aceita duplicatas por hora inezlimente em condutor
 - Problema - Nao tera acesso direto no BD pra mudar dados, seguindo politica de bd relacional
   mas eu mesmo nao gosto da ideia
 - Suspensao Temporaria (com data de inicio termino) pela Setransp mesmo (admin a priori)
 - Codigo -2 significa dados incorretos do form, seja por nulo ou improprios
 - appSettingsParts nao é usado, apenas esta la para referencia 
 - Agente de transito só consulta
 - Veiculo nao tem mesma placa, uma placa pra cada veiculo
 - ConduApp gerado pela app
 - Carro pode estar Suspenso para empresa apenas e cidade
 - Dados e consistencia ficam a cargo da empresa
 - Setransp vai ver empresa e status, e pode mudar esse
 - Qr equipe do rafa
 - Tabela de log de acoes, com campo de log obrigatorio
 - Autenticacao qndo usa API fica com a infra
 - Itinerario nao (km futuramente)
 - Deixar CPF unico (mas ainda usar id)
 - Compilacao de versoes novas de API sem derrubar o site
 - Carro pode estar Suspenso para empresa apenas e cidade
  - (nao fazer) Deveria checar a consistencia da placa talvez, talvez, pois é responsabilidade
 da empresa
 - A senha default do keykloak é 123, a usada padrao pra local dev etc é 1 a 6 ou 1 a 8Aa@
 - Keykloak role admin e gestor para meu usuario, em localhost:44310
 - Publicao do site fica em um lugar e backend api em outro
 - Status do motorista pode ser ativo inativo suspenso
 - CPF nao e unico pois vai haver incosistencias logo precisa deixar repetir, o q vai ser unico
   vai ser o id e o conduapp dele
 - hospedagem e url - \\desenvolvimento\ConduAp http://desenvolvimento:8018
 - datatime default - 01-01-2000
 - Dado que vai haver incosistencias a solucao provisoria ja foi pensada
 - Status de motorista refere-se a situacao dele na cidade como motorista de app geral
 - Status do carro idem a motorista
 - Credenciamento q diz se o dado motorista pode andar com aquele carro por aquela empresa
 - O metodo que retorna conduapp nao esta a prova de incosistencia pq nao tem como
 saber se um cpf esta duplicado com mais de um conduapp
 - Qndo o cpf nao tem conduapp vinculado, o retorno inicial é menos -1, depois outro
 metodo decide se ele sera inserido
 - O metodo getConduApp esta em dois arquivos
 - CreateConduapp apenas gera o numero, e nao insere no bd, e inclusive o numero nao
 e unico pois é gerado com base no ultimo numero inserido na tabela condutor



===========================================================================================
Backlog

 ok - rever - Hello World em Clean conectando com bd

 ok - Tabela com chave, auto increment correto

 ok - Conduap -  Alinhar nome do projeto

 ok - Versionar - adicionei remoto errado sem querer mas corrigi, 
  problema foi q gastou algumas horas

 ok - Implementar command com handler proprio e implicit operator, 
 modelstate na controller para uma entendi

 ok - Validacao IO (app - regras de negocio) com commands e handlers pra 
 fazer IO - Infra
 
 ok - Validacao command (command - datasets)
 
 ok - Ver os 3 espaços de validacao
 
 ok - Conversar com a gestora sobre se deve-se falar ou nao com o cliente, pois o escopo da memoria é um e a lei nao 
 
 ok - (geladeira) -  Ressalva consideravel - A validacao esta sendo feita artesanalmente para 

 ok - coelga disse q é ok usar viewmodel com clean

 ok - Fazer o json do objeto

 ok - Falta documentos na tabela condutor

 ok -  Lembrar onde colocar o data notation

 ok - Pedido de criacao do bd fica com a tata

 ok - Versionar

 ok - Ler assinador avançado pra ver Questoes do builder e modelo de dados

ok - Clean Architerure usando template, 

ok - Pedir Permissões de projeto - Ambiente git para esse projeto

ok - duvida - Usar viewmodel ou nao, olhar como esta o projeto

ok - duvida - Checar o projeto como um todo

ok - duvida - Seria o template mais pra se basear?

ok - duvida - O Assinador avançado nao tem projeto de api no UI

ok - duvida - Pq tem model na interface do domain

ok - duvida - Handler e CQRS nao estou usando mas tb nao lmebro de ter visto no template

ok - duvida - Comentar sobre focar em um design pattern ou outro pois todos nao vai dar

ok - duvida - Falta algo do tipo DTO

ok - duvida - A aplicacao mvc conhece infra

ok - duvida - Pq o dominio tem uma interface se ele nao deve conhecer ninguem, ele nao deveria saber que metodos
ele precisaria pois ele deveria conter apenas informacao, e nao metodos pq parecem implicar em regras
de negocio da aplicacao, sendo assim o dominio deveria conhecer apenas dominio

ok - Todo command precisa ter a ida e volta

ok - Nome do app e nome do bd, Sistema Conduap

ok - duvida - Caso do motorista alegar ser registrado mas placa nem qr forem encontrados 
(possivel incosistencia no dado enviado antes)

ok - Validacao Infra (Buidler) - Infra - IO

- ok -Cronograma - Talvez usar o monday ou algo do tipo, mas nao, tfs por ser conhecido
 pelos demais, acordado em reuniao

- ok - funcionou, problema estava na callback, Testar o q ja coloquei, olhar a
callback deles

ok - Ressalva - Existem mais opcoes mas foi optado o caminho mais simplicado, apesar disso
  foi tortuoso pois a documentacao é escassa e dispersa Ler e implementar keykloak

ok - CRUD completo para PRC exceto builder, e a mais controller UI usando controller API

ok - por enquanto uma so, mas alternativa futura seria uam area pra cada empresa. No bulk pode havar empresas colocando motoristas com dados incosistentes, o q fazer
 pois cada empresa vai dar um bulk, talvez precise de uma tabela de atualizacoes, e uma tabela que guarde o bulk

ok (teoria) - O que fazer com o mer qndo tem mudanca de requisito, criar mais tabelas ou nao

ok - Frizar em pedir os dados para a setranps e as empresas ao mesmo tempo, de preferencia ja entrar em contato com a vim te buscar

ok - Ler duvidas para reuniao, importante frizar q o pedido dos dados pode influenciar na entrega tanto da setransp qnto das empresas,
 e deixar isso homologado por email para caso ocorra atraso fica justificado

ok - nao pode - Precisa checar se pode criar veículo novamente com a mesma placa (a priori acho que não deveria)

ok- um - Quantos conduapp a pessoa vai ter

ok - Se a empresa para de atuar na cidade precisaria de um status de ativo/inativo

ok - tem - Preciso saber se temos exoneração de responsabilidade quanto a consistência de dados, como telefone do motorista

ok - ficam -  Os documentos CNH etc ficam a cargo da setransp, ou o app infelizmente precisara cuidar disso

ok - futuramente - dado que a lei afirma que o vínculo da empresa precisa ser renovado após 1 ano, deveria haver uma opção de
Renovação desde já no app ou poderiamos postergar isso

ok - nao precisa - Os tokens devem ser persistidos no bd? Onde? devem ser encripatados? 

ok - setransp - Três penalidades consecutivas, punição é o app ou o admin que coloca isso

ok - futuramente dados do itinerário dos motoristas seriam relevantes ou não

ok consistencia de dados a empresa q vai ficar responsavel, o log vai dizer quem fez o q - CPF não está sendo usado com chave primaria pois precisa-se saber se ele pode estar errado e
 por algum motivo precise ser atualizado, pois a validade do mesmo apenas a receita federal pode atestar

ok - Controller PRC do site MVC finalmente usando servico da API com viewmodl e command aparentemente

ok -  Refatoracao parcial concluida

ok - Replicar todo o fluxo acertado em PRC para veiculo

ok - Replicar todo o fluxo acertado em PRC para Contudor

ok - Ver onde tratar tudo isso na entrada pq n tem trativa em nada

ok - multproj - se precisa deixar o projeto da api rodando separado dado q os dois vao ficar separados 

ok Bug resolvido (2 a 4 horas) - o servico estava amarrado ao site mvc ainda, por isso
que dava pau em uma e na outra

ok - Replicar todo o fluxo acertado em PRC para Credenciamento

ok -  Autenticacao no swagger

ok - parcialmente refatorado pela alternativa funcionar bem possivelmente refatorar toda a parte da viewmodel

ok - colocar campo status e punicoes em prc

ok - Veiculo pode precisar de refatoracao pois a viewmodel deveria ser uma lista apenas, por hora nao

ok - nao fazer - pois vai haver incosistencia por parte das PRC - Deixar CPF unico (mas ainda usar id)

ok - nao fazer, se ja houver a placa cadastra duas vezes ou mais por hora. Deveria checar se 
 nao tem um veiculo com a placa ja cadastrada (unique talvez)
 antes de colocar (durante as gravações de dados após o bulk)

ok - Tabela Credenciamento (agregacao)

ok - SuperServico operando apenas para gerar condutores por hora

ok - Pegar o json exemplo sem autenticacao e chamar o servico

ok - coloquei implementacao em app mas nem tanto (superServico)

ok - nao, no maximo a tabela log - saber se os dados do bulk vao precisar ficar salvos ou nao apesar da responsabilidade
de dados ser da empresa (provavelmente nao)

ok - ja tinha - credenciamento precisa de data

- swagger tambem (2o swagger) modelagem json (super servico), no caso as empresas terao acesso
ao swagger qndo autenticarem

ok - pelo header - perguntar se a autenticacao pode vir pelo json

ok - deveria ser no handler com command quebrando em commands menores metodos getConduApp gerarConduApp 
precisam ser revisados pois podem nao estar nas melhores classes

ok - nao pode ir pra treinamento sem autenticacao frizar o servico sem autenticacao por hora em treinamento, 
depois com autenticacao pois ja se tem o json

ok (parcial) - coloca as validacoes nos demais commands

ok (parcial) - Servico pra garar o conduapp

ok - Comecar modelo do super servico do json, deve ser em credenciamento

ok (parcial) ver se o nome das camadas esta ok

===========================================================================================
worklog

31-08-2023

Versionamento, Criacao das Tabelas, Fazendo a folha

01-09-23

Dentro do Clean, get, getAll, getJSon

04 e 05 - 09-2023

Tempo integralmente gasto refatorando um exemplo de clean api
que nao atende os padroes pedidos